{"version":3,"sources":["../../bin/config.ts","../../bin/dump.ts"],"names":["DELIMITER","program","Command","Option","opts","rootPath","outDir","mode","isInline","fs","prepareIsInlineMode","data","acc","path","elements","elementKey","value","newPath","run","files","glob","result","fileName","keyName","f","locales","localLocales","locale","writeData"],"mappings":"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","file":"dump.mjs","sourcesContent":["export const DELIMITER = '-de-limit-er-'\n","#!/usr/bin/env node\n\nimport glob from 'fast-glob'\nimport { Command, Option } from 'commander'\n\nimport path from 'node:path'\nimport fs from 'node:fs'\n\nimport { DELIMITER } from './config'\n\nconst program = new Command()\n\nprogram\n  .version('0.1.0')\n  .description('CLI utils for i18n')\n  .addOption(new Option('-m, --mode [type]', 'set mode').choices(['single', 'split']).default('single'))\n  .addOption(new Option('-i, --inline', 'is inline mode').default(false))\n  .option('-p, --path [dir]', 'path for root dir')\n  .requiredOption('-d, --dir [name] ', 'output dir')\n\nprogram.parse()\n\nconst opts = program.opts()\n\nconst rootPath = opts?.path?.replace(/\\/$/, '') || '.'\nconst outDir = `${rootPath}/${opts.dir}`.replace(/\\/$/, '')\nconst mode = opts.mode\nconst isInline = opts.inline\n\nif (isInline && mode === 'single') {\n  throw new Error('inline mode working only for mode split')\n}\n\nif (!fs.existsSync(outDir)) {\n  fs.mkdirSync(outDir)\n}\n\n\nfunction prepareIsInlineMode (data: Record<string, Record<string, string>>):\n  Record<string, string> | Record<string, Record<string, string>> {\n  if (!isInline) return data\n\n  return Object.keys(data).reduce((acc, path) => {\n    const elements = data[path]\n    for (const elementKey of Object.keys(elements)) {\n      const value = elements[elementKey]\n      const newPath = `${String(path)}${DELIMITER}${String(elementKey)}`\n      acc[newPath] = value\n    }\n    return acc\n  }, {})\n}\n\nasync function run () {\n  const files = await glob(`${rootPath}/**/*.i18n.json`, {\n    cwd: process.cwd(),\n    absolute: false,\n    onlyFiles: true\n  })\n\n  const result = {}\n  for (const fileName of files) {\n    const keyName = fileName.replace(rootPath, '.')\n    const data = fs.readFileSync(fileName).toString('utf-8')\n    result[keyName] = JSON.parse(data)\n  }\n\n  if (!files.length) {\n    // eslint-disable-next-line no-console\n    console.log('Files not found. use: *.i18n.json format file')\n    return\n  }\n\n  for (const f of fs.readdirSync(outDir)) {\n    fs.rmSync(`${outDir}/${f}`)\n  }\n\n  if (mode === 'split') {\n    const locales = {}\n\n    for (const fileName of Object.keys(result)) {\n      const localLocales = Object.keys(result[fileName])\n\n      for (const locale of localLocales) {\n        if (!locales[locale]) locales[locale] = {}\n        locales[locale][fileName] = {}\n        locales[locale][fileName] = result[fileName][locale]\n      }\n    }\n\n    for (const locale of Object.keys(locales)) {\n      const writeData = JSON.stringify(prepareIsInlineMode(locales[locale]), null, 2)\n      fs.writeFileSync(path.resolve(outDir, `${locale}.json`), writeData, 'utf-8')\n    }\n  }\n\n  if (mode === 'single') {\n    const writeData = JSON.stringify(prepareIsInlineMode(result), null, 2)\n    fs.writeFileSync(path.resolve(outDir, 'locales.json'), writeData, 'utf-8')\n  }\n}\n\nvoid run()\n"]}